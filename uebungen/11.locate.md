# Übungen zu `locate`

## Vorbereitung

Stelle sicher, dass `locate` installiert ist. Wechsel in den Account von `root` mit `su -` und führe folgende Kommandos aus.
```bash
apt update
apt install locate
```
Wechsel wieder in den Account deines regulären Users nach der Installation mit `exit`.

## Übung 1: Grundlegende Funktionsweise verstehen

1. Suche nach allen Dateien, die "bash" im Namen enthalten.
2. Zähle, wie viele Ergebnisse gefunden wurden.
3. Begrenze die Ausgabe auf die ersten 10 Treffer.

2 und 3 sind wohl nicht alleine mit `locate` zu lösen, hier können wir uns aber eine kleine Pipe basteln.

>[!NOTE]
> Falls du gar keine Ergebnisse angezeigt bekommst: Wechsel wieder in den Account von `root` und führe dort das Kommando `updatedb` aus, verlasse den `root` Account wieder und versuche die Suche erneut.

## Übung 2: Die Datenbank und ihre Aktualität

1. Erstelle eine neue Datei im Home-Verzeichnis:
   ```bash
   touch ~/meine_testdatei_$(date +%s).txt
   ```
2. Versuche, die Datei mit `locate` zu finden:
   ```bash
   locate meine_testdatei
   ```
   **Frage:** Die Datei wird nicht gefunden! Warum? Lies dazu in der Manpage von `locate` nach, wie dieses Programm arbeitet.

3. Sorge nun dafür, dass `locate` die neu erstellte Datei doch findet.

## Übung 3: Geschwindigkeitsvergleich locate vs. find

>[!NOTE]
> Mit dem Kommando `time` kann man die Zeit messen, die ein Kommando braucht, um seine Aufgabe zu erfüllen. Dazu stellen wir `time` einfach vor das auszuführende Kommando. Wir wollen nun `locate` mit `find`, einem anderen Kommando zur Suche nach Dateien vergleichen. Die eigentlichen Suchergebnisse interessieren uns hier nicht, daher leiten wir sie um nach `/dev/null`.

1. Miss die Zeit, die `locate` braucht:
   ```bash
   time locate bash > /dev/null
   ```

2. Miss die Zeit für `find` im gleichen Suchbereich:
   ```bash
   time find / -name "*bash*" &>/dev/null
   ```
>[!NOTE] 
> Wir schauen uns `find` und seine Syntax auch noch etwas näher an bzw. kannst du dich ja in der Manpage informieren.

## Übung 4: Groß-/Kleinschreibung

1. Suche case-sensitive nach "README":
   ```bash
   locate README | head
   ```
2. Suche case-insensitive nach "readme":
   ```bash
   locate -i readme | head
   ```
**Frage:** Was ist der Unterschied in den Ergebnissen?

## Übung 5: Einschränkungen bei der Suche

1. Versuche, nur nach Dateien in deinem Home-Verzeichnis zu suchen. Das kann `locate` so nicht. Könnte eine Pipe mit einem anderen Kommando hier vielleicht hilfreich sein?
   ```bash
2. Versuche, nur nach Dateien (nicht Verzeichnissen) zu suchen mit `locate`. Erstelle dazu eine Datei mit dem Namen `file-found-it` und ein Verzeichnis `dir-found-it`. Sorge dafür, dass `locate` die neu erstellten Dateien überhaupt finden kann, nutze als Suchbegriff `found-it`. Kann `locate` das überhaupt?

3. **Zusatzaufgabe:** Schau in die Manpage von `find`. Gäbe es hiermit eine Möglichkeit, das Ziel zu erreichen?
   
## Übung 6: Regex-Suche mit locate

>[!NOTE]
> In dieser Übung wird Basiswissen über Reguläre Ausdrücke vorausgesetzt.

Die Suche mit `locate` lässt sich über Optionen nicht besonders gut fein einstellen. Wir können hier aber unser Wissen über Reguläre Ausdrücke anwenden, um gezielter suchen zu können.

1. Suche nach Konfigurationsdateien auf dem System, die auf `.conf` enden.
2. Suche mit einem regulären Ausdruck nach allen Konfigurationsdateien der BASH, auf dem gesamten Dateisystem. Gehe davon aus, dass diese alle mit `.bash` oder `bash` beginnen.
3. Suche nach Log-Dateien, aber nur im Verzeichnis `/var/log`.

## Übung 7: Existenz der gefundenen Dateien prüfen

Lösche die Datei `file-found-it` aus der vorigen Übung. Führe direkt danach eine neue Suche durch mit `locate file-found-it`. Die Datei wird noch angezeigt, obwohl sie gelöscht wurde. Suche in der Manpage von `locate` nach einer Option, die dafür sorgt, das gelöschte Dateien nicht mehr angezeigt werden, ohne das wir die Datenbank von `locate` aktualisieren müssen.

## Übung 8: Praktische Anwendungsfälle

1. Wo liegt die SSH-Konfigurationsdatei `sshd_config`?
2. Finde alle Python-Skripte im System.
3. Wo sind die Systemd-Service-Dateien (diese enden auf `.service`)?
4. Finde Log-Dateien, die heute bzw. zuletzt geändert wurden. Hier musst du vielleicht etwas überlegen und dir vielleicht eine kleine Pipeline zusammenbauen, `locate` selbst kennt keine Zeitstempel. 

## Übung 9: Statistiken zur Datenbank

Wie kannst du dir Informationen über die Datenbank von `locate` anzeigen lassen wie z.B.:

- Wie viele Verzeichnisse indexiert sind
- Wie viele Dateien in der Datenbank sind
- Wie groß die Datenbank ist
- Wann sie zuletzt aktualisiert wurde

## Übung 10: updatedb konfigurieren

1. Schaue dir die Konfiguration von `updatedb` an:
   ```bash
   less /etc/updatedb.conf
   ```
2. Welche Dateisysteme werden nicht durchsucht?
3. Welche Pfade werden ausgeschlossen?
4. Was könnte der Grund sein?
